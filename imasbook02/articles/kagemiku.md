# うづコインを支える技術
<p class="right">著:kagemiku</p>

## はじめに
プロデューサーの皆さん、担当アイドルのこと、ちゃんとすこですか？僕はすこです。あ〜すこ。
すこの形はいろいろあると思います。グッズを買うというすこ。楽曲をひたすら聴くというすこ。 神棚でフィギュアを祀るというすこ。みんな違って、みんなすこい。
中でも、副業でエンジニアをされているプロデューサーの方々は、ちょっとしたプロダクトやサービスを開発する、という形ですこを表現している方も多いと思います。
例を挙げると、**im@sparql**(\*1)などがそうです。これは特定のアイドルに対するすこというより、「アイドルマスター」という文化そのものに対するすこという、より上位次元のすこを表現していると思われます。
本章で解説する「うづコイン」も、そういったすこすこプロダクトの中の一つです。

<footer>\*1 https://sparql.crssnky.xyz/imas/</footer>

## うづコインとは？
あ〜うづきすこ！すこだな〜〜という思いから生まれた、推し仮想通貨です。アイマスハッカソン2018(\*2)で爆誕しました。

<img src="images/kagemiku/uzucoin_slide.png" width="150">

酔っ払って作ったものなのでよく覚えていませんが、これは当時の発表スライド(\*3)です。
**UZK**を単位とする、推し仮想通貨です。


<footer>\*2 https://imas.connpass.com/event/70592/</footer>
<footer>\*3 https://speakerdeck.com/kagemiku/udukoin</footer>


### うづきチェーン
うづコインの取引記録は、「うづきブロック」と呼ばれるブロックに保存されており、このブロック同士を単方向リストとしてつなげたものを「うずきチェーン」と呼びます。本当です。
各うづきブロックは、一つ前のうづきブロックのSHA256ハッシュ値(へご値とも呼ばれている)を保持しています。

<img src="images/kagemiku/uzuki_chain.png" width="300">

各うづきブロックは次の情報を保持しています。

* transaction : 取引記録
* nonce : ノンス(後述)
* prevHash : 直前のうづきブロックのハッシュ値(へご値とも呼ばれている)
* resolverUID : ノンスを提供したユーザのID(後述)

また、`transaction`には次の情報が含まれています。

* fromUID : 送金元のユーザID
* toUID : 送金先のユーザID
* amount : 送金額[uzk]
* timestamp : 送金要求を行った時刻のタイムスタンプ

### S(min)ING!
うづきチェーンに新しくうづきブロックを追加する際には、追加しようとしているうづきブロックが、「いい感じ」のハッシュ値を持つように調整しなければなりません。この調整を行うための値が「ノンス」となります。
この「ハッシュ値がいい感じ」になるようなノンスを見つける作業は簡単なものではなく、それ故に、ノンスを見つけたユーザに対しては一定の報酬(うづコイン)が支払われるようになっています。ノンスを見つけだし報酬を得ることは、他のユーザからの送金以外で、ユーザが新たなうづコインを受け取る唯一の方法となっています。

 「いい感じ」の定義は、うづきブロックのSHA256ハッシュ値(へご値とも呼ばれている)内に、次の文字列のASCII列が含まれていることです。

| 文字列 | 報酬 |
|:------:|:----:|
| uzuki  | 24.0 |
| uzu    | 4.0  |
| zuki   | 4.0  |
| u      | 1.0  |
| zu     | 1.0  |
| ki     | 1.0  |

表内のASCII列が含まれているハッシュ値になるノンスを提供したユーザには、それぞれ対応する報酬(うづコイン)がもらえます。ちなみに島村卯月の誕生日は4/24です。偶然ですね。

ちなみに、この「ノンスを見つけ出す作業」は、一般に**S(min)ING!**と呼ばれています。偶然ですね。


## サーバ実装
うづコインのサーバサイドはGoで実装されており、クライアントに対してはgRPC(\*4)を用いてAPIを提供しています。
2019/02/16現在、コードの公開はしておりませんが、整備が完了し次第publicにする予定です。本当です。多分。

<footer>\*4 https://grpc.io/</footer>

### 通信について

## Let’s S(min)ING!

## おわりに
みんなありがとー！
